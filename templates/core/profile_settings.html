{% extends 'base_app.html' %}

{% block title %}Profile Settings - Chatty{% endblock %}

{% block app_content %}
<aside class="sidebar">
    <div class="sidebar-logo"><i class="fas fa-comments"></i></div>
    <nav class="sidebar-nav">
        <a href="{% url 'chat:chat_list' %}" class="sidebar-item"><i class="fas fa-comment-dots"></i></a>
    </nav>
    <div class="sidebar-bottom">
        <a href="{% url 'core:settings' %}" class="sidebar-item active"><i class="fas fa-cog"></i></a>
    </div>
</aside>

<div class="settings-container">
    <div class="settings-header">
        <a href="{% url 'core:settings' %}" class="btn btn-ghost btn-sm"><i class="fas fa-arrow-left"></i></a>
        <h1>Edit Profile</h1>
    </div>
    
    <div class="settings-content">
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="settings-section">
                <div class="profile-pic-upload">
                    <div class="avatar avatar-lg avatar-placeholder" id="avatarPreview">
                        {% if request.user.profile_pic %}
                        <img src="{{ request.user.profile_pic.url }}" alt="" id="avatarImg">
                        {% else %}
                        {{ request.user.username|make_list|first|upper }}
                        {% endif %}
                    </div>
                    <div>
                        <label class="btn btn-secondary btn-sm">
                            <i class="fas fa-camera"></i> Change Photo
                            <input type="file" name="profile_pic" accept="image/*" id="profilePicInput" style="display:none;">
                        </label>
                        <p class="text-muted text-small mt-1">JPG, PNG. Max 5MB.</p>
                    </div>
                </div>
            </div>
            
            <div class="settings-section">
                <div class="form-group">
                    <label class="form-label">Display Name</label>
                    {{ form.name }}
                </div>
                
                <div class="form-group">
                    <label class="form-label">Username</label>
                    {{ form.username }}
                    <span class="form-hint">Your unique identifier</span>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Bio</label>
                    {{ form.bio }}
                    <span class="form-hint">Tell others about yourself</span>
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary btn-block">Save Changes</button>
        </form>
    </div>
</div>

<style>
.settings-header{display:flex;align-items:center;gap:16px;padding:24px 32px;background:var(--bg-secondary);border-bottom:1px solid var(--border-color)}
.settings-header h1{font-size:20px;font-weight:600}
.settings-section{background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:var(--radius-lg);padding:24px;margin-bottom:24px}
.profile-pic-upload{display:flex;align-items:center;gap:20px}
.profile-pic-upload .avatar{width:100px;height:100px;font-size:36px}
.profile-pic-upload img{width:100%;height:100%;object-fit:cover;border-radius:50%}
</style>

<script>
document.getElementById('profilePicInput').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById('avatarPreview');
            let img = preview.querySelector('img');
            if (!img) {
                img = document.createElement('img');
                img.id = 'avatarImg';
                preview.innerHTML = '';
                preview.appendChild(img);
            }
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    }
});
</script>
{% endblock %}
